# Интерфейс

* [...Добавить `add`. Достать посмотреть `get`](c540cd00-332e-11e7-8e5c-eb8b742bbc4d)
* [Добавление](c540f410-332e-11e7-8e5c-eb8b742bbc4d)
* [Получение посмотреть](c541b760-332e-11e7-8e5c-eb8b742bbc4d)
* [JSON-объект заметки, её id и связь с базой](c541b761-332e-11e7-8e5c-eb8b742bbc4d)
* [Обновление (синхронизация, редактирование)](c541de70-332e-11e7-8e5c-eb8b742bbc4d)
* [Удаление](c541de71-332e-11e7-8e5c-eb8b742bbc4d)
* [Формат заметки, отделения заметок друг от друга в файле, дата](c5420580-332e-11e7-8e5c-eb8b742bbc4d)

<!-- {"id":"6078b19e-386e-11e7-b322-bd492bfb44d5","date":"2017-05-14T06:27:02.595Z","type":"tree"}-->

* * *

Добавить `add`. Достать посмотреть `get`. Синхронизировать с базой (редактирование, обновить) `sync`. Удалить `delete`.

<!-- {"id":"c540cd00-332e-11e7-8e5c-eb8b742bbc4d","date":"2017-05-04T05:33:28.837Z"}-->

* * *

# Добавление

`$ nuka add`

`$ nuka add "Писать надо коротко и понятно"`

`$ nuka add "Идеи проектов.md"` 

`$ nuka add **/*.*` 

`$ nuka add --content` - добавить заметку через редактор.

`$ nuka add --content "Писать надо коротко и понятно"` - добавить заметку в командной строке.

`$ nuka add --content "Идеи проектов.md"` - добавить все заметки из файла.

`$ nuka add --content **/*.*` - добавить все заметки из всех файлов.

`$ nuka add --tree`

`$ nuka add --tree "Документация сервиса заметок"`

`$ nuka add --tree "Идеи проектов.md"`

`$ nuka add --tree **/*.*`

<!-- {"id":"c540f410-332e-11e7-8e5c-eb8b742bbc4d","date":"2017-05-04T05:33:28.837Z"}-->

* * *

# Получение посмотреть

`$ nuka get` 

`$ nuka get [id]` получить заметку по id

`$ nuka get "структура, словарь"` 

`$ nuka get "Список заметок.md"` 

`$ nuka get **/*.md` 

`$ nuka get --content` 

`$ nuka get --content [id]` получить заметку по id

`$ nuka get --content "структура, словарь"` 

`$ nuka get --content "Список заметок.md"` 

`$ nuka get --content **/*.md` 

`$ nuka get --tree` 

`$ nuka get --tree [id]` получить заметку по id

`$ nuka get --tree "структура, словарь"` 

`$ nuka get --tree "Список заметок.md"` 

`$ nuka get --tree **/*.md`

<!-- {"id":"c541b760-332e-11e7-8e5c-eb8b742bbc4d","date":"2017-05-04T05:33:28.837Z"}-->

* * *

# JSON-объект заметки, её id и связь с базой

Все заметки хранятся в виде файлов в папке `.mr/content/`. Именем файла-заметки является её id. Точнее первые два символа id составляют директорию, а остальные уже имя файла-заметки, например `.mr/content/27/b4f720-282d-11e7-86bc-09f71d5e7e04.md`. Промежуточные директории играют чисто техническую роль уменьшить количество файлов в директориях - лучше 100 директорий по 100 файлов чем одна на 10 000.

Заметка это блок markdown-текста. При добавлении в базу к этому тексту добавляется специальный HTML-комментарий с JSON-объектом полезных свойств заметки: дата, id, тип и другие, если нужно. Например, по адресу выше лежит файл с таким содержимым:

```markdown

    # Оперативные заметки для возвращения к ним
    Это туду, расчет сметы. Дневниковые сессии. Они должны быть на видном месте (1).

    *Обобщение списка*
    Простыня заметок (часто с названиями заметок как щас) - должны быть уметь сворачиваться в нечто помещающееся в мозг

    <!-- {"date":"2016-06-05T19:34:26.171Z","id":"27b4f720-282d-11e7-86bc-09f71d5e7e04","excerpt":" Оперативные заметки для возвращения..."} -->

```

В комментариях `<!-- -->` в JSON-объекте полное id этой заметки, дата, короткая выдержка.

Когда мы получаем заметку из базу через `$ nuka get`, мы получаем именно этот текст - с подобным HTML-комментарием где записана id этой заметки. 

Когда мы добавляем текст заметки любым способом парсер читает её текст и если находит в тексте эти комментарии с id, записывает файл-заметку с соответствующим именем в базе (в папке `.mr/content/`). Таким образом если будет найден id уже существующего файла-заметки, он перезапишется новой версией - это и есть способ редактировать, обновлять - просто повторно скармливать парсеру заметку с указанным в ней id. Собственно этот id внутри JSON-объекта в тексте заметки - единственная её связь со своей копией в базе. Если вы его потеряли, теоретически заметку можно найти по поиску или по дате, но это заморочка - лучше просто не удалять JSON-объект.

Рабочий процесс поэтому обычно выглядит так - мы создаём заметку например в файле (в некоей нашей рабочей директории), затем натравляем на неё парсер. Он читает все заметки, если находит заметки без проставленных id в JSON-объекте, то создаёт новые файлы, а если находит с уже проставленными - перезаписывает по этим id-адресам найденные файлы заметок новыми обновлёнными заметками из вашего файла). А затем перезаписывает ваш исходный файл, но уже расставив всем заметкам эти id в комментариях. Дальше можно редактировать старые заметки, дописывать новые. И когда опять придёт время - опять напускать парсер на этот файл. Он создаст и обновит нужные в базе и обновит ваш файл этими новыми id. И так далее.

Все более сложные структуры (дерево заметок) являются теми же самыми markdown-заметками в виде файлов с именем их id и обновление (редактирование, синхронизация) их просходит по тому же принципу.

<!-- {"id":"c541b761-332e-11e7-8e5c-eb8b742bbc4d","date":"2017-05-04T05:33:28.837Z"}-->

* * *

# Обновление (синхронизация, редактирование)

`$ nuka sync`

`$ nuka sync [id]`

`$ nuka sync "Моя короткая заметочка"`

`$ nuka sync "Идеи проектов.md"`

`$ nuka sync **/*.md`

`$ nuka sync --content`

`$ nuka sync --content [id]`

`$ nuka sync --content "Моя короткая заметочка"`

`$ nuka sync --content "Идеи проектов.md"`

`$ nuka sync --content **/*.md`

`$ nuka sync --tree`

`$ nuka sync --tree [id]`

`$ nuka sync --tree "Моя короткая заметочка"`

`$ nuka sync --tree "Идеи проектов.md"`

`$ nuka sync --tree **/*.md`

<!-- {"id":"c541de70-332e-11e7-8e5c-eb8b742bbc4d","date":"2017-05-04T05:33:28.837Z"}-->

* * *

# Удаление

`$ nuka delete`

`$ nuka delete [id]` - удалить файл-заметку из базы по её id

`$ nuka delete "Какой-то тут произвольный текст, а также через запятую`

`$ nuka delete "Идеи проектов.md"`

`$ nuka delete **/*.*`

`$ nuka delete --content`

`$ nuka delete --content [id]`

`$ nuka delete --content "Моя короткая заметочка"`

`$ nuka delete --content "Идеи проектов.md"`

`$ nuka delete --content **/*.md`

`$ nuka delete --tree`

`$ nuka delete --tree [id]`

`$ nuka delete --tree "Моя короткая заметочка"`

`$ nuka delete --tree "Идеи проектов.md"`

`$ nuka delete --tree **/*.md`

<!-- {"id":"c541de71-332e-11e7-8e5c-eb8b742bbc4d","date":"2017-05-04T05:33:28.837Z"}-->

* * *

# Формат заметки, отделения заметок друг от друга в файле, дата

Заметка - это просто текст в простом случае и постепенно приближающийся к формату markdown в сложных. И есть несколько соглашений именно для сервиса, максимально старающиеся соблюдать человекочитаемость заметки.

а) Если в файле несколько заметок, их нужно отделять пустой строкой, затем три звезды с одним пробелом между ними и ещё одна пустая строка.

```
    Одна короткая заметка

    * * *

    Надо бы убраться на кухне @идея

```

б) Если нужно датировать заметки, дата пишется в первом заголовке заметки, например

```
    # 1 сентября 2016, Как я провёл лето

    Клёво.
```

Парсер возьмет эту дату как приоритетную при формировании JSON-объекта свойств заметки. Это удобно например в случае журнала или личного дневника, который вам удобно держать в одном файле в вашей рабочей папке и видеть предыдущие заметки, а не добавлять за раз по одной заметке сразу через командную строку или вспомогательный редактор. И чтоб их посмотреть нужно будет запускать новую команду и знать их id. Вообще для тематических заметок и более сложных вложенных структур существуют команды работы с узлами и деревьями. Там сервис наконец имеет возможность исполнить свою цель создания. 

в) Уже известный вам формат для помещения JSON-объектов в заметку, для связи вашей её копии с той что в базе, делается через формат HTML-комментариев, например 

```
    <!-- {"date":"2016-06-05T19:34:26.171Z","id":"27b4f720-282d-11e7-86bc-09f71d5e7e04","excerpt":" Оперативные заметки для возвращения..."} -->
```

г) Остальные соглашения уже для более высокой организации заметок - узлов и деревьев. И ссылок на заметки. Если коротко, то вложенные структуры записываются как вложенные markdown-заголовки, а ссылки реализуются через markdown-ссылки. Сложный файл заметки-дерева вместе с JSON-объектом его свойств может выглядеть, например, так:

```
    # Учение о бытии
    [С чего следует начинать...](123a52d0-2eb4-11e7-89cf-8977f28d315d2)
    [Общее подразделение бытия](234a52d0-2eb4-11e7-89cf-8977f28d315d2)

    ## Определённость
    [Бытие](345a52d0-2eb4-11e7-89cf-8977f28d315d2)
    [Наличное бытие](456a52d0-2eb4-11e7-89cf-8977f28d315d2)

    ## Величина
    ### Количество
    [Чистое количество](567a52d0-2eb4-11e7-89cf-8977f28d315d2)
    [Непрерывная и дискретная величина](678a52d0-2eb4-11e7-89cf-8977f28d315d2)
    [Ограничение количества](789a52d0-2eb4-11e7-89cf-8977f28d315d2)

    ## Мера
    [Специфическое количество](891a52d0-2eb4-11e7-89cf-8977f28d315d2)

    <!-- {"date":"2016-06-05T19:34:26.171Z","id":"27b4f720-282d-11e7-86bc-09f71d5e7e04"} -->
```

<!-- {"id":"c5420580-332e-11e7-8e5c-eb8b742bbc4d","date":"2017-05-04T05:33:28.837Z"}-->