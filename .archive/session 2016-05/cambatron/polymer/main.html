<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Камбатрон</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<script src="../bower_components/firebase/firebase.js"></script>
	<script src="../bower_components/webcomponentsjs/webcomponents-lite.js"></script>
	<link rel="import" href="components.html">
</head>

<body class="fullbleed layout vertical">

	<template is="dom-bind" id="app">
		<paper-header-panel mode="waterfall-tall" tall-class="medium-tall" xclass="cyan">
			<paper-toolbar class="medium-tall">
				<div>Клуб Ахмад</div>
				<div class="flex"></div>
				<mr-button class="primary">новая задача</mr-button>
			</paper-toolbar>

			<div class="content">
				<main>

					<form id="new-task" on-submit="submitTask" style="margin: 0px 16px;">
						<paper-input placeholder="Добавить новую задачу" on-focus="inputFocused" on-blur="inputBlurred"></paper-input>
					</form>

					<div id="actions">
						<paper-icon-button icon="block" on-click="unselectall"></paper-icon-button>
						<div>Выбрано: <span>{{listselected.length}}</span></div>
						<div style="margin-left: auto; margin-right: 0; line-height: 24px;">
							<paper-icon-button icon="delete" on-click="deleteselected"></paper-icon-button>
							<!-- <paper-icon-button icon="create" hidden$="[[!singleselected]]"></paper-icon-button> -->
						</div>
					</div>

					<div id="preload">Грузим...</div>

					<array-selector id="selector" items="{{tasks}}" selected="{{listselected}}" multi></array-selector>

					<!-- <template is="dom-repeat" items="[[listselected]]">
						<wtt-entry id="[[item.id]]">
							<mr-time value="[[item.start]]" item-icon></mr-time>
							<paper-item-body>
								<mr-description value="[[item.description]]"></mr-description>
							</paper-item-body>
							<mr-duration long value="[[duration(item)]]" style="margin-right: 0;"></mr-duration>
						</wtt-entry>
					</template> -->

					<!-- <p>&nbsp;</p> -->

					<div style="margin: 8px 0px 8px 0px;">
						<template is="dom-repeat" items="[[tasks]]" sort="_reverseStart" id="listitems">
							<wtt-entry id="[[item.id]]" entry="[[item]]" on-click="selectitem" on-mousedown="startwaitedit" on-mouseup="checkedititem">
								<div item-icon>
									<!-- <template is="dom-if" if="[[!edit]]"> -->
										<mr-time value="[[item.start]]" item-icon></mr-time>
									<!-- </template> -->
									<!-- <template is="dom-if" if="[[edit]]">
										<paper-input value="{{item.start}}"></paper-input>
									</template>
									<button on-click="selectitem">sel</button> -->
								</div>
								<paper-item-body>
									<mr-description value="[[item.description]]"></mr-description>
								</paper-item-body>
								<template is="dom-if" if="[[!index]]">
									<div id="timer">
										<paper-icon-button icon="alarm-off" xclass="primary" style="line-height: 20px;"></paper-icon-button>
										<mr-timer format="precise" started="[[item.start]]" style="display: inline-block; width: 64px; text-align: right;"></mr-timer>
									</div>
								</template>
								<template is="dom-if" if="[[index]]">
									<mr-duration long value="[[duration(item)]]" style="margin-right: 0;"></mr-duration>
								</template>
							</wtt-entry>
						</template>
					</div>

					<div id="total" style="xposition: fixed; left: 50%; bottom: 0; xtransform: translateX(-50%); xbackground-color: white; width: 100%; max-width: 480px; display: none;">
						<paper-item style="border-top: solid rgba(0,0,0,0.26) 1px; box-shadow: 0px -4px 0px 0px rgba(0,0,0,0.0);">
							<div class="flex" style="xcolor: rgba(0,0,0,0.54); font-size: 16px; line-height: 24px; font-weight: 300;">Всего за <a href="#">сегодня</a></div>
							<mr-duration format="long" value="[[total]]" class="total"></mr-duration>
						</paper-item>
					</div>
				</main>
			</div>
		</paper-header-panel>
	</template>

	<script>

		var app = document.querySelector("#app");
		app.addEventListener("dom-change", function () {
			console.log("My app started!");
			window.timer = Polymer.dom(app[0]).querySelector("mr-timer");
			window.totalbar = Polymer.dom(app[0]).querySelector("#total");
			window.ironselector = Polymer.dom(app[0]).querySelector("#ironselector");

		});

		app.myHandle = function (e) {
			console.log("%c We scroll content", "color: #607d8b; font-family: Roboto;" )
		};

		app.project = "Idealmaster";
		app.tasks = [];
		app.duration = function (entry) {
			if (Array.isArray(entry)) {
				var result = 0;
				for (var i = 0; i < entry.length; i++) {
					result += (entry[i].stop ? entry[i].stop : (new Date()).getTime()) - entry[i].start;
				}
				return result;
			} else {
				return entry.stop - entry.start;
			}
		}
		app._reverseStart = function (a, b) {
			return b.start - a.start;
		}
		app.inputFocused = function () {
			console.log("we are focused");
			// document.getElementById("new-item-label").classList.add("primary");
			// document.getElementById("new-time").classList.add("primary");
		}
		app.inputBlurred = function () {
			console.log("we are blurred");
			// document.getElementById("new-item-label").classList.remove("primary");
			// document.getElementById("new-time").classList.remove("primary");
		}
		app.submitTask = function (event) {
			console.dir(event.target[0]);
			entriesRef.push({
				start: (new Date()).getTime(),
				description: event.target[0].value,
				stop: (new Date()).getTime() + Math.floor(Math.random()*3600000)
			});
			event.target[0].value = "";
			event.preventDefault();
		}
		app.listselected = [];
		app.listKeys = {};
		app.startwaitedit = function () {
			app._waitedittimeout = setTimeout(function () {
				console.log("show edit");
				app._editmode = true;
			}, 1000);
		}
		app.checkedititem = function () {
			if (app._waitedittimeout) {
				clearTimeout(app._waitedittimeout);
			}
		};
		app.edititem = function (event) {
			// (убрать потом app._editmode)
			console.log("REAL EDIT");
			app._editmode = false;
		}
		app.selectitem = function (event) {
			var el;

			if (app._waitedittimeout) {
				clearTimeout(app._waitedittimeout);
			}

			if (app._editmode) {
				app.edititem(event);
				return;
			}

			// console.log(event, event.model);

			event.path.every(function (element) {
				if (element.tagName.toLowerCase() == "wtt-entry") {
					el = element;
					return false;
				} else {
					return true;
				}
			});

			if (app.listselected.indexOf(event.model.item) > -1) {
				app.$.selector.deselect(event.model.item);
				// app.listKeys[event.model.item.id].removeAttribute("edit");
				delete app.listKeys[event.model.item.id];
			} else {
				app.$.selector.select(event.model.item);
				app.listKeys[event.model.item.id] = el;
			}

			// Вкл/выкл элемент
			app.togglelement(el);

			// Всё в режим нередактирования
			for (var i in app.listKeys) {
				if (app.listKeys.hasOwnProperty(i)) {
					// app.listKeys[i].removeAttribute("edit");
				}
			}

			// Если первый раз
			if (app.listselected.length == 1) {
				// console.log("ONE Left");
				setContentSelected(true);
				// Либо включаем себя (если мы выбрали)
				if (app.listKeys[event.model.item.id]) {
					// app.listKeys[event.model.item.id].setAttribute("edit", true);
					// event.model.edit = true;
				} else {
					// либо то что осталось в массиве (если мы сняли выделение со всего кроме одного)
					// app.listKeys[Object.keys(app.listKeys)[0]].setAttribute("edit", true);
				}
			}

			// Если последний
			if (app.listselected.length == 0) {
				// console.log("None left");
				setContentSelected(false);
				// el.removeAttribute("edit");
			}
		};
		app.togglelement = function (element, force) {
			// console.log(force);
			if (force != undefined) {
				element.classList.toggle("iron-selected", force);
			} else {
				element.classList.toggle("iron-selected");
			}
			element.setAttribute("elevation", (force == undefined ? (element.getAttribute("elevation") != "1" ? 1 : 0) : (force ? 1 : 0)));
		}
		app.selected = function (item) {
			// console.log("selected", item, app.listselected.indexOf(item));
			var result = (app.listselected.indexOf(item) < 0 ? false : true);
			console.log("Select", result, app.listKeys);
			return result;
		};
		app.mode = function (item) {
			// console.log(item, "mode");
			if (app.listselected.indexOf(item) > -1) {
				return "selected";
			} else {
				return "";
			}
		};
		app.deleteselected = function () {
			// console.log(app.listselected);
			while (app.listselected.length > 0) {
				entriesRef.child(app.listselected[0].id).remove();
				app.togglelement(app.listKeys[app.listselected[0].id]);
				app.splice("tasks", app.tasks.indexOf(app.listselected[0]), 1);
				app.$.selector.deselect(app.listselected[0]);
			}
			setContentSelected(false);
			document.getElementById("listitems").render();
		};
		app.unselectall = function () {
			while (app.listselected.length > 0) {
				app.togglelement(app.listKeys[app.listselected[0].id]);
				app.$.selector.deselect(app.listselected[0]);
			}
			setContentSelected(false);
		};


		function setContentSelected (flag) {
			Polymer.dom(app[0]).querySelector("paper-header-panel").classList.toggle("iron-selected", flag);
		}

		var total = app.total;

		var entriesRef = new Firebase("https://brilliant-fire-1299.firebaseio.com/cambatron/wtt-book");
		var currentList = entriesRef.orderByChild("start").limitToLast(10);
		currentList.on("child_added", function (snapshot) {
			app.unshift("tasks", {
				start: snapshot.val().start,
				stop: snapshot.val().stop,
				description: snapshot.val().description,
				id: snapshot.key()
			});
			app.total = app.duration(app.tasks);
			localStorage.setItem("tasks", JSON.stringify(app.tasks));
			window.totalbar.style.display = "block";
			window.preload.style.display = "none";
		});

		// currentList.on("child_removed", function (snapshot) {
		// 	var id = -1;
		// 	app.tasks.every(function (item, index) {
		// 		if (item.id == snapshot.key()) {
		// 			id = index;
		// 			return false;
		// 		} else {
		// 			return true;
		// 		}
		// 	});
		// 	app.splice("tasks", id, 1);
		// 	document.getElementById("listitems").render();
		// });


		// JSON.parse(localStorage.getItem("tasks")).forEach(function (item) {
		// 	app.tasks.push(item);
		// 	app.total = app.duration(app.tasks);
		// });


		/**
		 *  Импортируемые данных из старых таймеров
		 */
		var acts = {
		    "1": {
		        "start": 1435582371273,
		        "stop": 1435583330175,
		        "id": "1",
		        "taskid": "1"
		    },
		    "2": {
		        "start": 1435582011245,
		        "stop": 1435582356913,
		        "id": "2",
		        "taskid": "2"
		    },
		    "3": {
		        "start": 1435574147096,
		        "stop": 1435581819176,
		        "id": "3",
		        "taskid": "3"
		    },
		    "4": {
		        "start": 1435573498946,
		        "stop": 1435574133186,
		        "id": "4",
		        "taskid": "4"
		    },
		    "5": {
		        "start": 1435573436232,
		        "stop": 1435573483176,
		        "id": "5",
		        "taskid": "5"
		    },
		    "6": {
		        "start": 1435573389139,
		        "stop": 1435573389141,
		        "id": "6",
		        "taskid": "6"
		    },
		    "8": {
		        "start": 1430829163929,
		        "stop": 1430834245717,
		        "id": "8",
		        "taskid": "7"
		    },
		    "9": {
		        "start": 1430805950641,
		        "stop": 1430815052732,
		        "id": "9",
		        "taskid": "7"
		    },
		    "10": {
		        "start": 1430544274144,
		        "stop": 1430569503013,
		        "id": "10",
		        "taskid": "7"
		    },
		    "11": {
		        "start": 1435742610132,
		        "stop": 1435742620132,
		        "id": "11",
		        "taskid": "7"
		    },
		    "12": {
		        "start": 1430286560523,
		        "stop": 1430305760523,
		        "id": "12",
		        "taskid": "7"
		    },
		    "13": {
		        "start": 1430225053727,
		        "stop": 1430227223010,
		        "id": "13",
		        "taskid": "7"
		    },
		    "14": {
		        "start": 1430207665500,
		        "stop": 1430220145500,
		        "id": "14",
		        "taskid": "7"
		    },
		    "15": {
		        "start": 1430111037236,
		        "stop": 1430141517236,
		        "id": "15",
		        "taskid": "7"
		    },
		    "16": {
		        "start": 1429863129219,
		        "stop": 1429867748567,
		        "id": "16",
		        "taskid": "7"
		    },
		    "17": {
		        "start": 1428986743466,
		        "stop": 1428994187997,
		        "id": "17",
		        "taskid": "8"
		    },
		    "18": {
		        "start": 1428576373384,
		        "stop": 1428581050488,
		        "id": "18",
		        "taskid": "8"
		    },
		    "19": {
		        "start": 1428493973320,
		        "stop": 1428500621005,
		        "id": "19",
		        "taskid": "8"
		    },
		    "20": {
		        "start": 1428476873628,
		        "stop": 1428489989001,
		        "id": "20",
		        "taskid": "8"
		    },
		    "21": {
		        "start": 1428042735335,
		        "stop": 1428056472003,
		        "id": "21",
		        "taskid": "8"
		    },
		    "22": {
		        "start": 1427959295680,
		        "stop": 1427959809002,
		        "id": "22",
		        "taskid": "9"
		    },
		    "23": {
		        "start": 1427869672964,
		        "stop": 1427886840006,
		        "id": "23",
		        "taskid": "7"
		    },
		    "24": {
		        "start": 1435656454132,
		        "stop":  1435656454332,
		        "id": "24",
		        "taskid": "10"
		    },
		    "25": {
		        "start": 1435656283332,
		        "stop": 1435656293332,
		        "id": "25",
		        "taskid": "10"
		    },
		    "26": {
		        "start": 1435656393332,
		        "stop": 1435656423332,
		        "id": "26",
		        "taskid": "10"
		    },
		    "27": {
		        "start": 1427774448130,
		        "stop": 1427780635005,
		        "id": "27",
		        "taskid": "8"
		    },
		    "28": {
		        "start": 1427457169961,
		        "stop": 1427482969961,
		        "id": "28",
		        "taskid": "7"
		    },
		    "29": {
		        "start": 1427431360634,
		        "stop": 1427441864763,
		        "id": "29",
		        "taskid": "8"
		    },
		    "30": {
		        "start": 1427387548584,
		        "stop": 1427391803762,
		        "id": "30",
		        "taskid": "8"
		    },
		    "31": {
		        "start": 1427386517436,
		        "stop": 1427387530763,
		        "id": "31",
		        "taskid": "8"
		    },
		    "32": {
		        "start": 1427381411779,
		        "stop": 1427383983788,
		        "id": "32",
		        "taskid": "9"
		    },
		    "33": {
		        "start": 1427354262090,
		        "stop": 1427355159762,
		        "id": "33",
		        "taskid": "11"
		    },
		    "34": {
		        "start": 1427350593290,
		        "stop": 1427353853760,
		        "id": "34",
		        "taskid": "12"
		    },
		    "35": {
		        "start": 1427279715749,
		        "stop": 1427281010769,
		        "id": "35",
		        "taskid": "8"
		    },
		    "36": {
		        "start": 1427275884318,
		        "stop": 1427279004794,
		        "id": "36",
		        "taskid": "9"
		    },
		    "37": {
		        "start": 1427172333099,
		        "stop": 1427190144760,
		        "id": "37",
		        "taskid": "7"
		    },
		    "38": {
		        "start": 1427114068702,
		        "stop": 1427123090761,
		        "id": "38",
		        "taskid": "8"
		    },
		    "39": {
		        "start": 1427096447264,
		        "stop": 1427096911762,
		        "id": "39",
		        "taskid": "8"
		    },
		    "40": {
		        "start": 1427086891032,
		        "stop": 1427091745576,
		        "id": "40",
		        "taskid": "8"
		    },
		    "41": {
		        "start": 1426859645062,
		        "stop": 1426862973761,
		        "id": "41",
		        "taskid": "13"
		    },
		    "42": {
		        "start": 1426859431537,
		        "stop": 1426859632761,
		        "id": "42",
		        "taskid": "8"
		    },
		    "43": {
		        "start": 1426849513486,
		        "stop": 1426857585761,
		        "id": "43",
		        "taskid": "7"
		    },
		    "44": {
		        "start": 1426837774132,
		        "stop": 1426839888761,
		        "id": "44",
		        "taskid": "8"
		    },
		    "45": {
		        "start": 1426835790650,
		        "stop": 1426836413097,
		        "id": "45",
		        "taskid": "8"
		    },
		    "46": {
		        "start": 1426751662214,
		        "stop": 1426773876138,
		        "id": "46",
		        "taskid": "8"
		    },
		    "47": {
		        "start": 1426683321549,
		        "stop": 1426709162151,
		        "id": "47",
		        "taskid": "7"
		    },
		    "48": {
		        "start": 1426657120075,
		        "stop": 1426663881150,
		        "id": "48",
		        "taskid": "7"
		    },
		    "49": {
		        "start": 1426588037418,
		        "stop": 1426591791139,
		        "id": "49",
		        "taskid": "8"
		    },
		    "50": {
		        "start": 1426587830133,
		        "stop": 1426587889139,
		        "id": "50",
		        "taskid": "8"
		    },
		    "51": {
		        "start": 1426587828109,
		        "stop": 1426587828111,
		        "id": "51",
		        "taskid": "13"
		    },
		    "52": {
		        "start": 1426572445763,
		        "stop": 1426574679139,
		        "id": "52",
		        "taskid": "13"
		    },
		    "53": {
		        "start": 1426507025612,
		        "stop": 1426518975139,
		        "id": "53",
		        "taskid": "8"
		    },
		    "54": {
		        "start": 1426502391407,
		        "stop": 1426504991140,
		        "id": "54",
		        "taskid": "8"
		    },
		    "55": {
		        "start": 1426499135068,
		        "stop": 1426500727138,
		        "id": "55",
		        "taskid": "9"
		    },
		    "56": {
		        "start": 1426484338620,
		        "stop": 1426490234138,
		        "id": "56",
		        "taskid": "9"
		    },
		    "57": {
		        "start": 1426482996941,
		        "stop": 1426484203141,
		        "id": "57",
		        "taskid": "8"
		    },
		    "58": {
		        "start": 1426244360901,
		        "stop": 1426255934171,
		        "id": "58",
		        "taskid": "8"
		    },
		    "59": {
		        "start": 1426236244732,
		        "stop": 1426238044732,
		        "id": "59",
		        "taskid": "10"
		    },
		    "60": {
		        "start": 1426227203489,
		        "stop": 1426234821139,
		        "id": "60",
		        "taskid": "8"
		    },
		    "61": {
		        "start": 1426164111943,
		        "stop": 1426186911943,
		        "id": "61",
		        "taskid": "8"
		    },
		    "62": {
		        "start": 1426158207640,
		        "stop": 1426163386140,
		        "id": "62",
		        "taskid": "8"
		    },
		    "63": {
		        "start": 1426151130164,
		        "stop": 1426151146139,
		        "id": "63",
		        "taskid": "8"
		    },
		    "64": {
		        "start": 1426151098237,
		        "stop": 1426151102138,
		        "id": "64",
		        "taskid": "8"
		    },
		    "65": {
		        "start": 1426142817417,
		        "stop": 1426151086164,
		        "id": "65",
		        "taskid": "8"
		    },
		    "66": {
		        "start": 1426084749180,
		        "stop": 1426087708946,
		        "id": "66",
		        "taskid": "8"
		    },
		    "67": {
		        "start": 1426072113882,
		        "stop": 1426082466946,
		        "id": "67",
		        "taskid": "8"
		    },
		    "68": {
		        "start": 1426063134526,
		        "stop": 1426068815947,
		        "id": "68",
		        "taskid": "8"
		    },
		    "69": {
		        "start": 1426058038644,
		        "stop": 1426062403946,
		        "id": "69",
		        "taskid": "8"
		    },
		    "70": {
		        "start": 1425994307744,
		        "stop": 1425999707744,
		        "id": "70",
		        "taskid": "8"
		    },
		    "71": {
		        "start": 1425982553119,
		        "stop": 1425990353119,
		        "id": "71",
		        "taskid": "8"
		    },
		    "72": {
		        "start": 1425980494806,
		        "stop": 1425981960948,
		        "id": "72",
		        "taskid": "8"
		    },
		    "73": {
		        "start": 1425969717071,
		        "stop": 1425978974947,
		        "id": "73",
		        "taskid": "8"
		    },
		    "74": {
		        "start": 1425897001021,
		        "stop": 1425900130957,
		        "id": "74",
		        "taskid": "8"
		    },
		    "75": {
		        "start": 1425885462002,
		        "stop": 1425892532956,
		        "id": "75",
		        "taskid": "8"
		    },
		    "76": {
		        "start": 1425657627830,
		        "stop": 1425661047830,
		        "id": "76",
		        "taskid": "8"
		    },
		    "77": {
		        "start": 1425647424617,
		        "stop": 1425649824617,
		        "id": "77",
		        "taskid": "8"
		    },
		    "78": {
		        "start": 1425632796967,
		        "stop": 1425638958977,
		        "id": "78",
		        "taskid": "8"
		    },
		    "79": {
		        "start": 1425622500883,
		        "stop": 1425623831978,
		        "id": "79",
		        "taskid": "10"
		    },
		    "80": {
		        "start": 1425573279186,
		        "stop": 1425584079186,
		        "id": "80",
		        "taskid": "8"
		    },
		    "81": {
		        "start": 1425551431845,
		        "stop": 1425556891845,
		        "id": "81",
		        "taskid": "8"
		    },
		    "82": {
		        "start": 1425543646396,
		        "stop": 1425547616980,
		        "id": "82",
		        "taskid": "8"
		    },
		    "83": {
		        "start": 1425489831249,
		        "stop": 1425497173977,
		        "id": "83",
		        "taskid": "8"
		    },
		    "84": {
		        "start": 1425485406368,
		        "stop": 1425488709981,
		        "id": "84",
		        "taskid": "8"
		    },
		    "85": {
		        "start": 1425458208350,
		        "stop": 1425470341978,
		        "id": "85",
		        "taskid": "8"
		    },
		    "86": {
		        "start": 1425458200110,
		        "stop": 1425461800110,
		        "id": "86",
		        "taskid": "8"
		    },
		    "87": {
		        "start": 1425386817040,
		        "stop": 1425389217040,
		        "id": "87",
		        "taskid": "8"
		    },
		    "88": {
		        "start": 1425384379546,
		        "stop": 1425389779546,
		        "id": "88",
		        "taskid": "8"
		    },
		    "89": {
		        "start": 1425366378888,
		        "stop": 1425377178888,
		        "id": "89",
		        "taskid": "8"
		    },
		    "90": {
		        "start": 1425189941738,
		        "stop": 1425200741738,
		        "id": "90",
		        "taskid": "8"
		    },
		    "91": {
		        "start": 1425019712306,
		        "stop": 1425019712306,
		        "id": "91",
		        "taskid": "10"
		    },
		    "92": {
		        "start": 1425019692491,
		        "stop": 1425019692493,
		        "id": "92",
		        "taskid": "8"
		    },
		    "93": {
		        "start": 1423246278444,
		        "stop": 1423269427994,
		        "id": "93",
		        "taskid": "14"
		    },
		    "94": {
		        "start": 1423051808266,
		        "stop": 1423056146010,
		        "id": "94",
		        "taskid": "9"
		    },
		    "95": {
		        "start": 1423048273701,
		        "stop": 1423051564012,
		        "id": "95",
		        "taskid": "9"
		    },
		    "96": {
		        "start": 1423023700025,
		        "stop": 1423030900025,
		        "id": "96",
		        "taskid": "14"
		    },
		    "97": {
		        "start": 1422921627597,
		        "stop": 1422925745012,
		        "id": "97",
		        "taskid": "14"
		    },
		    "98": {
		        "start": 1422917081106,
		        "stop": 1422920819011,
		        "id": "98",
		        "taskid": "14"
		    },
		    "99": {
		        "start": 1422871894538,
		        "stop": 1422877785014,
		        "id": "99",
		        "taskid": "14"
		    },
		    "100": {
		        "start": 1422464578944,
		        "stop": 1422486066603,
		        "id": "100",
		        "taskid": "14"
		    },
		    "101": {
		        "start": 1422382645248,
		        "stop": 1422398002603,
		        "id": "101",
		        "taskid": "14"
		    },
		    "102": {
		        "start": 1422291782973,
		        "stop": 1422302875687,
		        "id": "102",
		        "taskid": "15"
		    },
		    "103": {
		        "start": 1422274115184,
		        "stop": 1422289999687,
		        "id": "103",
		        "taskid": "15"
		    },
		    "104": {
		        "start": 1422271992788,
		        "stop": 1422273668685,
		        "id": "104",
		        "taskid": "15"
		    },
		    "105": {
		        "start": 1422259311552,
		        "stop": 1422266565685,
		        "id": "105",
		        "taskid": "15"
		    },
		    "106": {
		        "start": 1421666639828,
		        "stop": 1421670980842,
		        "id": "106",
		        "taskid": "14"
		    },
		    "107": {
		        "start": 1421663953465,
		        "stop": 1421665541779,
		        "id": "107",
		        "taskid": "14"
		    },
		    "108": {
		        "start": 1421663781298,
		        "stop": 1421666181298,
		        "id": "108",
		        "taskid": "14"
		    },
		    "109": {
		        "start": 1419424274312,
		        "stop": 1419428732280,
		        "id": "109",
		        "taskid": "9"
		    },
		    "110": {
		        "start": 1419420676930,
		        "stop": 1419422864487,
		        "id": "110",
		        "taskid": "9"
		    },
		    "111": {
		        "start": 1419409688404,
		        "stop": 1419416888404,
		        "id": "111",
		        "taskid": "9"
		    },
		    "112": {
		        "start": 1413815307868,
		        "stop": 1413818907868,
		        "id": "112",
		        "taskid": "16"
		    },
		    "113": {
		        "start": 1413785860455,
		        "stop": 1413789460455,
		        "id": "113",
		        "taskid": "16"
		    },
		    "114": {
		        "start": 1435744632894,
		        "stop": 1435744652894,
		        "id": "114",
		        "taskid": "11"
		    },
		    "115": {
		        "start": 1435744612894,
		        "stop": 1435744622894,
		        "id": "115",
		        "taskid": "16"
		    },
		    "116": {
		        "start": 1413453608479,
		        "stop": 1413454023681,
		        "id": "116",
		        "taskid": "16"
		    }
		};

		var tasks = {
		    "1": {
		        "id": "1",
		        "acts": ["1"],
		        "name": "отдаем результат",
		        "parentid": "18"
		    },
		    "2": {
		        "id": "2",
		        "acts": ["2"],
		        "name": "перерыв 1",
		        "parentid": "18"
		    },
		    "3": {
		        "id": "3",
		        "acts": ["3"],
		        "name": "верстаем",
		        "parentid": "18"
		    },
		    "4": {
		        "id": "4",
		        "acts": ["4"],
		        "name": "подготовка",
		        "parentid": "18"
		    },
		    "5": {
		        "id": "5",
		        "acts": ["5"],
		        "name": "думаем",
		        "parentid": "18"
		    },
		    "6": {
		        "id": "6",
		        "acts": ["6"],
		        "parentid": "17",
		        "name": "Wifi-страница для Техносилы"
		    },
		    "7": {
		        "id": "7",
		        "acts": ["8", "9", "10", "11", "12", "13", "14", "15", "16", "23", "28", "37", "43", "47", "48"],
		        "parentid": "20",
		        "name": "Админка",
		    },
		    "8": {
		        "id": "8",
		        "acts": ["17", "18", "19", "20", "21", "27", "29", "30", "31", "35", "38", "39", "40", "42", "44", "45", "46", "49", "50", "53", "54", "57", "58", "60", "61", "62", "63", "64", "65", "66", "67", "68", "69", "70", "71", "72", "73", "74", "75", "76", "77", "78", "80", "81", "82", "83", "84", "85", "86", "87", "88", "89", "90", "92"],
		        "parentid": "21",
		        "name": "Idealmaster"
		    },
		    "9": {
		        "id": "9",
		        "acts": ["22", "32", "36", "55", "56", "94", "95", "109", "110", "111"],
		        "parentid": "21",
		        "name": "neq4"
		    },
		    "10": {
		        "id": "10",
		        "acts": ["24", "25", "26", "59", "79", "91"],
		        "parentid": "21",
		        "name": "Ahmad"
		    },
		    "11": {
		        "id": "11",
		        "acts": ["33", "114"],
		        "parentid": "21",
		        "name": "Кофемания FM"
		    },
		    "12": {
		        "id": "12",
		        "acts": ["34"],
		        "parentid": "21",
		        "name": "Цветочная лавка"
		    },
		    "13": {
		        "id": "13",
		        "acts": ["41", "51", "52"],
		        "parentid": "22",
		        "name": "Подписка"
		    },
		    "14": {
		        "id": "14",
		        "acts": ["93", "96", "97", "98", "99", "100", "101", "106", "107", "108"],
		        "parentid": "19",
		        "name": "Medoscope"
		    },
		    "15": {
		        "id": "15",
		        "acts": ["102", "103", "104", "105"],
		        "parentid": "21",
		        "name": "Космос"
		    },
		    "16": {
		        "id": "16",
		        "acts": ["112", "113", "115", "116"],
		        "parentid": "21",
		        "name": "Сheapside"
		    },
		    "17": {
		        "id": "17",
		        "name": "Евгений Гребёнкин",
		        "childrenid": ["6","18"]
		    },
		    "18": {
		        "id": "18",
		        "name": "Wifi-страница для Техносилы",
		        "childrenid": ["1", "2", "3", "4", "5"],
		        "parentid": "17"
		    },
		    "19": {
		        "id": "19",
		        "name": "Петров",
		        "childrenid": ["20", "14"]
		    },
		    "20": {
		        "id": "20",
		        "name": "Medoscope",
		        "childrenid": ["7"],
		        "parentid": "19"
		    },
		    "21": {
		        "id": "21",
		        "name": "Маша Нигголь",
		        "childrenid": ["8", "9", "10", "11", "12", "15", "16"]
		    },
		    "22": {
		        "id": "22",
		        "name": "Андрей Чиж",
		        "childrenid": ["13"]
		    }


		};

		var tasktree = {
		    "Евгений Гребёнкин": {
		        "type": "group",
		        "name": "Евгений Гребёнкин",
		        "tasks": {
		            "Wifi-страница для Техносилы": {
		                "type": "group",
		                "name": "Wifi-страница для Техносилы",
		                "tasks": {
		                    "отдаем результат": {
		                        "type": "task",
		                        "name": "отдаем результат",
		                        "taskid": "1"
		                    },
		                    "перерыв 1": {
		                        "type": "task",
		                        "name": "перерыв 1",
		                        "taskid": "2"
		                    },
		                    "верстаем": {
		                        "type": "task",
		                        "name": "верстаем",
		                        "taskid": "3"
		                    },
		                    "подготовка": {
		                        "type": "task",
		                        "name": "подготовка",
		                        "taskid": "4"
		                    },
		                    "думаем": {
		                        "type": "task",
		                        "name": "думаем",
		                        "taskid": "5"
		                    }
		                }
		            }
		        }
		    },
		    "Петров": {
		        "type": "group",
		        "name": "Петров",
		        "tasks": {
		            "Medoscope": {
		                "type": "group",
		                "name": "Medoscope",
		                "tasks": {
		                    "Админка": {
		                        "type": "task",
		                        "name": "Админка",
		                        "taskid": "7"
		                    }
		                }
		            }
		        }
		    },
		    "Маша Нигголь": {
		        "type": "group",
		        "name": "Маша Нигголь",
		        "tasks": {
		            "Idealmaster": {
		                "type": "task",
		                "name": "Idealmaster",
		                "taskid": "8"
		            },
		            "neq4": {
		                "type": "task",
		                "name": "neq4",
		                "taskid": "9"
		            },
		            "Ahmad": {
		                "type": "task",
		                "name": "Ahmad",
		                "taskid": "10"
		            },
		            "Кофемания FM": {
		                "type": "task",
		                "name": "Кофемания FM",
		                "taskid": "11"
		            },
		            "Цветочная лавка": {
		                "type": "task",
		                "name": "Цветочная лавка",
		                "taskid": "12"
		            },
		            "Космос": {
		                "type": "task",
		                "name": "Космос",
		                "taskid": "15"
		            },
		            "Сheapside": {
		                "type": "task",
		                "name": "Сheapside",
		                "taskid": "16"
		            }
		        }
		    },
		    "Андрей Чиж": {
		        "type": "group",
		        "name": "Андрей Чиж",
		        "tasks": {
		            "Подписка": {
		                "type": "task",
		                "name": "Подписка",
		                "taskid": "13"
		            }
		        }
		    }
		};

		// var entries = [];
		// var entriesRef = new Firebase("https://brilliant-fire-1299.firebaseio.com/cambatron/wtt-book");
		// for (var i in acts) {
		// 	if (acts.hasOwnProperty(i)) {
		// 		var entry = {
		// 			start: acts[i].start,
		// 			stop: acts[i].stop,
		// 			description: tasks[acts[i].taskid].name
		// 		};
		// 		entries.push(entry);
		// 		entriesRef.push(entry);
		// 	}
		// }




	</script>

</body>
</html>